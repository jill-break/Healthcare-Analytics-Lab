Design Decisions Document
Project: Healthcare Analytics - OLTP to Star Schema Migration
Target Database: olap_healthtech


DECISION 1: FACT TABLE GRAIN

Selected Option: Option A: One row per encounter.

Justification:
The primary business process being analyzed is the "Patient Encounter" (a single hospital visit).
1. Metric Accuracy: Revenue (claim_amount) and time (duration) are attributes of the visit itself.
2. Avoiding Duplication: Choosing "Diagnosis" as the grain (Option B) would cause the 'claim_amount' 
to repeat for every diagnosis in a single visit, leading to massive revenue over-reporting (Fan Trap).
3. Query Alignment: 3 out of the 4 business questions focus on encounter counts or revenue totals, 
which aligns perfectly with the encounter grain.


DECISION 2: DIMENSION TABLES

I will create 8 dimension tables in the 'olap_healthtech' database to support filtering and grouping:

1. dim_date
   - Attributes: date_key (PK), full_date, year, quarter, month, day_name, is_weekend.
   - Purpose: Optimized for Question 1 & 4 (Monthly reporting).

2. dim_patient
   - Attributes: patient_key (PK), patient_id, current_age, age_group ('0-18', '19-65', '65+').
   - Purpose: Demographics analysis. I calculate 'age_group' during ETL to avoid runtime case 
   statements.

3. dim_provider
   - Attributes: provider_key (PK), provider_id, full_name, credential.
   - Purpose: Tracking doctor performance.

4. dim_specialty
   - Attributes: specialty_key (PK), specialty_id, specialty_name.
   - Purpose: Primary grouping attribute for most queries.

5. dim_department
   - Attributes: department_key (PK), department_id, department_name.
   - Purpose: Location analysis.

6. dim_encounter_type
   - Attributes: encounter_type_key (PK), encounter_type_name.
   - Purpose: Filtering (e.g., 'Inpatient' only).

7. dim_diagnoses (used via Bridge)
   - Attributes: diagnosis_key (PK), icd10_code, description.
   
8. dim_procedures (used via Bridge)
   - Attributes: procedure_key (PK), cpt_code, description.


DECISION 3: PRE-AGGREGATED METRICS

The 'fact_encounters' table will store specific metrics calculated during the ETL 
process to eliminate expensive runtime joins:

1. is_readmission (BIT/BOOLEAN)
   - Logic: A complex look-back is performed during ETL to check if an inpatient visit 
   occurred within 30 days of a previous discharge.
   - Benefit: This transforms Question 3 from a slow Self-Join (~2.0s) into a simple 
   WHERE clause (instant).

2. diagnosis_count & procedure_count (INT)
   - Logic: Pre-counting the number of items in the source junction tables.
   - Benefit: Allows complexity analysis without needing to join the bridge tables.

3. total_allowed_amount (DECIMAL)
   - Logic: Denormalized from the 'billing' table.
   - Benefit: Completely eliminates the need to join the 'billing' table for 
   revenue queries (Question 4), reducing join complexity.


DECISION 4: BRIDGE TABLES

Will I use bridge tables? YES.

Justification:
Healthcare data contains inherent Many-to-Many relationships:
- One Encounter -> Many Diagnoses
- One Encounter -> Many Procedures

I implemented two bridge tables in 'olap_healthtech':
1. bridge_encounter_diagnoses
2. bridge_encounter_procedures

This allows me to handle the "Top Diagnosis-Procedure Pairs" query (Question 2) 
accurately without polluting the main Fact table grain.